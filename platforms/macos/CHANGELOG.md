# Changelog

## [1.2.0] - 2025-11-20 - Production Release

### Production Ready
- ✅ **Production-ready версия** - удалены все тестовые компоненты и валидация
- ✅ **Оптимизация памяти** - поддержка записей до 2 часов без потери данных
- ✅ **Долгосрочная стабильность** - автоматическая очистка памяти и сборка мусора
- ✅ **Улучшенная надежность** - исправлены все критические ошибки

### Fixed
- Исправлена ошибка `'AudioRecorder' object has no attribute 'logger'` в `_cleanup_recording_resources`
- Исправлена ошибка `NameError: name 'time_module' is not defined`
- Улучшена обработка ошибок при очистке ресурсов

### Removed
- Удалена система валидации результатов транскрипции (production-ready)
- Удален референсный текст для тестирования (`test_reference_text.txt`)
- Удалены тестовые инструкции (`ИНСТРУКЦИЯ_ТЕСТИРОВАНИЯ.md`)
- Удален модуль `src/utils/validator.py`
- Удалена секция `validation` из конфигурации

### Improved
- Увеличен размер очереди до 135,000 чанков (поддержка до 2 часов записи)
- Добавлена явная очистка памяти после каждой транскрипции
- Добавлена периодическая сборка мусора каждые 5 минут
- Оптимизирована работа для долгосрочной стабильности (недели без перезапуска)

## [1.1.0] - 2025-11-20

### Fixed
- **Критическое исправление:** Устранены артефакты и потеря данных в длинных записях
  - Исправлена перезапись очереди без ограничений в `start_recording()`
  - Убрано удаление старых чанков при переполнении очереди (причина потери данных)
  - Добавлена надежная синхронизация с `threading.Event` для завершения callback'ов
  - Улучшен алгоритм сбора данных с проверкой стабильности очереди
- **Улучшена транскрипция длинных записей:**
  - Снижен `no_speech_threshold` с 0.6 до 0.3 для более чувствительной транскрипции
  - Добавлена диагностика качества аудио сигнала
  - Добавлено логирование stderr от whisper.cpp для диагностики
  - Добавлена проверка результата транскрипции с предупреждениями

### Added
- Поддержка записей до 30 минут и более с гарантированной целостностью данных
- Детальная диагностика качества аудио (уровень сигнала, предупреждения)
- Проверка результата транскрипции с сравнением ожидаемого объема текста
- Улучшенное логирование для отладки проблем с транскрипцией
- Валидация и нормализация чанков перед конкатенацией

### Improved
- Надежность сбора данных из очереди при остановке записи
- Защита от переполнения памяти с правильным использованием maxsize очереди
- Динамические таймауты транскрипции для длинных записей
- Проверка дискового пространства перед сохранением WAV файлов

## [1.0.0] - 2025-11-04

### Added
- Первая версия Voice-to-Text приложения для macOS
- Поддержка whisper.cpp с Core ML и Metal ускорением для Apple Silicon
- Полностью офлайн транскрипция без интернет-зависимости
- Интеграция с macOS: автовставка текста, глобальные горячие клавиши
- Menu bar приложение с иконками состояния
- Поддержка русского языка с оптимизацией
- Health check система для диагностики
- Полная конфигурация через config.yaml

### Features
- Высокая точность распознавания (Whisper Large v3)
- Быстрая транскрипция на Apple Silicon (M1/M2/M3/M4)
- Автоматическая вставка текста в место курсора
- Глобальные горячие клавиши (Option+Space)
- Локальная обработка без отправки данных в облако
- Настраиваемые параметры транскрипции
- Подробная система логирования и диагностики

### Technical
- Python 3.12+ с современным стеком зависимостей
- whisper.cpp с Core ML и Metal оптимизациями
- rumps для macOS menu bar интеграции
- PyObjC для системных API
- pydantic для строгой валидации конфигурации